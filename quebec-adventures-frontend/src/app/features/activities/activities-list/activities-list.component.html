<div class="page">
  <!-- Header de la page (gard√© tel quel, juste regroup√© le bouton) -->
  <header class="page__header">
    <div class="header-content">
      <h1 class="page__title">Liste des activit√©s</h1>
      <p class="page__subtitle">Restaurants, parcs, aventures et coups de c≈ìur.</p>
    </div>
    
    <!-- Bouton Ajouter d√©plac√© ici pour √™tre align√© √† droite du titre -->
    <a routerLink="/activities/new" class="btn-add">
      <span class="icon">+</span> Ajouter
    </a>
  </header>

  <!-- BARRE DE FILTRES -->
  <section class="filters-bar">
    <form [formGroup]="filterForm" class="filters-form">
      
      <!-- Recherche Texte -->
      <div class="filter-group search-group">
        <input type="text" formControlName="search" placeholder="Rechercher (ex: poutine, ski)...">
        <span class="search-icon">üîç</span>
      </div>

      <!-- Selects -->
      <div class="filter-group">
        <select formControlName="region">
          <option value="">Toutes les r√©gions</option>
          <option *ngFor="let r of regions" [value]="r">{{ r }}</option>
        </select>
      </div>

      <div class="filter-group">
        <select formControlName="type">
          <option value="">Tous les types</option>
          <option *ngFor="let t of types" [value]="t">{{ t }}</option>
        </select>
      </div>

      <div class="filter-group">
        <select formControlName="priceRange">
          <option value="">Tous les prix</option>
          <option *ngFor="let p of prices" [value]="p">{{ p }}</option>
        </select>
      </div>
      
      <!-- Bouton Reset (Optionnel) -->
      <button type="button" (click)="filterForm.reset()" class="btn-reset" *ngIf="filterForm.dirty">
        Effacer
      </button>

    </form>
  </section>

  <ng-container *ngIf="!error; else errorTpl">
    <ng-container *ngIf="activities$ | async as activities; else loadingTpl">
      
      <!-- La Grille -->
      <div class="grid">
        <article class="card" *ngFor="let activity of activities"
         (click)="goToDetail(activity.id)" 
         style="cursor: pointer;"
        >

          <a [routerLink]="['/activities', activity.id]" class="card__link-wrapper"></a>
          
          <!-- NOUVEAU : Header de carte avec Image + Badges flottants -->
          <div class="card__header">
            <!-- Fallback image si vide -->
            <img [src]="activity.coverImage || 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=800'" 
                 [alt]="activity.title" 
                 class="card__image"
                 loading="lazy" />
            
            <span class="badge badge--type">{{ activity.type }}</span>
            <span class="badge badge--price">{{ activity.priceRange }}</span>
          </div>

          <!-- Corps de la carte -->
          <div class="card__body">
            <div class="card__top">
              <h3 class="card__title">{{ activity.title }}</h3>
              <!-- Affiche la note seulement si > 0 -->
              <span class="rating-badge" *ngIf="activity.rating > 0">
                ‚òÖ {{ activity.rating }}
              </span>
            </div>

            <!-- Description tronqu√©e (g√©r√©e par CSS) -->
            <p class="card__desc">{{ activity.description }}</p>

            <!-- Localisation -->
            <div class="card__location">
              üìç {{ activity.city }}, {{ activity.region }}
            </div>
          </div>

          <!-- NOUVEAU : Footer avec Actions -->
          <div class="card__footer">
            <a [routerLink]="['/activities', activity.id, 'edit']" class="btn-action btn-edit">
              Modifier l'activit√©
            </a>
            <button (click)="onDelete(activity.id, $event)" class="btn-action btn-delete">
              Supprimer l'activit√©
            </button>
          </div>

        </article>
      </div>
    </ng-container>
  </ng-container>

  <ng-template #loadingTpl>
    <div class="state">Chargement des activit√©s‚Ä¶</div>
  </ng-template>

  <ng-template #errorTpl>
    <div class="state state--error">Erreur lors du chargement des activit√©s.</div>
  </ng-template>
</div>
